## Использование

[Скриншоты интерфейса](#интерфейс)

### Глоссарий

юзер - незалогиненный пользователь (из внешних команд)<br>
админ/эдитор - залогиненный пользователь

### Создание полностью нового ТЗ либо новой версии ТЗ:  

Просто создайте **новое** ТЗ, и оно будет создано с последней доступной схемой (схема — это поля, названия, другими словами — структура документа).  
Каждое вновь создаваемое ТЗ (не версия, и именно полностью новое ТЗ) получает свой уникальный `group_id` и хранит его всегда.<br>

На основе этого `group_id` вычисляется актуальная версия ТЗ для шаринга (см. далее).

### Создание новой версии существующего ТЗ
Вы можете создать **новую версию** существующего ТЗ (aka сделать форк), и у вас есть две опции выбора схемы:

- При форке можно выбрать **схему родительской** версии ТЗ (поля, список и состав event'ов будут взяты из схемы родительской версии)
- Применить **последнюю доступную схему**.  
  - Новые появившиеся в новой схеме поля в этом случае будут пустыми.
  - Если какое-то поле было удалено из новой схемы (по сравнению со старой схемой), оно также будет удалено в новой версии.  

Когда вы создаёте форк от существуюшего ТЗ (новую версию), она будет создана с новым `assignment_id`, но тем же `group_id`.<br>
Необходимо опять же, для группировки всех версий ТЗ вокруг одной `group_id`, на основе которой вычисляется актуальная версия.

### Версионность ТЗ

Не путайте два понятия:  
- **Версионность данных** (это означает, что есть две версии документа с одинаковой структурой (схемой), но с разными данными).  
- **Версионность схемы** (это означает, что есть два документа, основанных на двух разных структурах).  

Если просто добавить еще одно изображение, событие или блок (что бы это ни было в будущем), схема останется той же,  
потому что, например, `Blocks` — это поле `list`, и новый элемент просто добавится в список.<br>
Добавление нового элемента в список не ведет к изменению схемы, это как был список, так и остался.
А вот добавление нового поля (в самом коде программы), или добавление нового event'а (или изменение его состава) — ведет к изменению схемы.  

Все версии ТЗ полностью независимы и не зависят друг от друга.  
Они хранят свою схему прямо в документе, поэтому всегда содержат всю информацию.  

### Шаринг ТЗ:  

У ТЗ, помимо режима собственно редактирования (edit) есть два режима просмотра (view):
- Просмотр актуальной версии ТЗ (aka просмотр по group_id. **Используется для шаринга с юзерами!**)   
- Просмотр конкретной версии ТЗ (Просмотр по assignment_id. Доступен только для залогиненных юзеров)

Если вы хотите пошарить ТЗ с кем-то, то нужно шарить ссылку на **Актуальную Версию**!<br>
Это постоянная ссылка, но по ней будет динамически подтягиваться последняя актуальная версия ТЗ.<br>
Актуальная версия - Это версия ТЗ с максимальным номером версии + в статусе выше `design` среди всех версий ТЗ с одним `group_id`.<br>
Если таких ТЗ в данной `group_id` не нашлось (все в статусе `design`, например), то будет показана соответсвующая заглушка.<br>

**Нельзя шарить ссылку на конкретную версию ТЗ**, потому что у юзеров нет доступа к страницам конкретных версий!<br>

Суть инструмента показывать юзерам последнюю актуальную версию ТЗ, и скрывать от них промежуточные этапы.
Поэтому конкретная версия ТЗ и не шарится.

### Список event'ов и данные в event'ах:  

Список ивентов и их состав можно изменить в `app/config/events_mapper.yaml`:<br>
- `key`: обязательное
- `value`: обязательное
- `comment`: необязательное

Любое изменение влечет за собой изменение схемы, т.о. только вновьсозданные ТЗ (либо версии ТЗ с применнеием новой схемы) будут содержать изменения.<br>
Старые ТЗ будут содержать старый набор ивентов и данных в ивентах.

### Значения по умолчанию для ТЗ:  
Значения по-умолчанию, подставляемые при создании нового ТЗ можно изменить в Pydantic-моделях `app/core/models/assignment.py`.  
Эти изменения порождают изменение схемы ТЗ.

Любые изменения можно вносить на лету, перезапуск приложения не требуется.  
Если изменения почему-то не применились, перезапустите докер контейнер

### Изменения схемы:  

Производятся путем изменения Pydantic-модели.  
Предыдущие документы будут сохранены и отображаться со схемой, актуальной в момент их создания.  

## Интерфейс

![edit_1.png](/doc/images/edit_1.png)
![list_1.png](/doc/images/list_1.png)
![view_1.png](/doc/images/view_1.png)
![user_1.png](/doc/images/user_1.png)
